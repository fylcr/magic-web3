# .github/workflows/publish-docs-to-readme.yml
name: Publish Docs to ReadMe

on:
  # 1) push åˆ° docs åˆ†æ”¯è‡ªåŠ¨è§¦å‘
  push:
    branches:
      - docs

  # 2) æ‰‹åŠ¨è§¦å‘æ—¶ï¼Œè®©ç”¨æˆ·å¯ä»¥é€‰åˆ†æ”¯ï¼ˆé»˜è®¤ docsï¼‰
  workflow_dispatch:
    inputs:
      branch:
        description: 'Which branch contains your docs folder?'
        required: true
        default: 'docs'

jobs:
  publish-readme:
    runs-on: ubuntu-latest

    steps:
      # â—ï¸ ä¸€å®šè¦åœ¨ checkout æ—¶æŒ‡å®š refï¼Œè®© runner çœŸæ­£æ‹‰ä¸‹ docs åˆ†æ”¯çš„å†…å®¹
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          # å½“æ˜¯ push è§¦å‘æ—¶ï¼Œgithub.ref å°±æ˜¯ "refs/heads/docs"
          # å½“æ˜¯ workflow_dispatch æ—¶ï¼Œç”¨ç”¨æˆ·è¾“å…¥çš„ branch
          ref: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.branch || github.ref }}
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # è¿™é‡Œæˆ‘ä»¬æ¨èç”¨å®˜æ–¹ Actionï¼Œå†…éƒ¨ä¼šè°ƒç”¨ rdme@9
      - name: Sync docs via ReadMe Action
        uses: readmeio/rdme@v9.0.0
        with:
          # è¿™ä¸€è¡Œè·Ÿ CLI è¯­æ³•ä¸€è‡´
          rdme: docs ./docs --key=${{ secrets.README_API_KEY }}

      - name: Done
        run: echo "ğŸ“š Docs have been published to ReadMe.com ğŸ‰"
